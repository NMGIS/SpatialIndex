<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spatial Index Performance Demo</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- App CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <h1>Spatial Indexing Performance Demo</h1>
        <p>Compare query speeds with and without PostGIS spatial indexes</p>
    </header>

    <main>
        <div class="controls">
            <button id="run-query-btn">Run Spatial Query</button>
            <span class="query-desc">Queries the current map extent (bounding box)</span>
        </div>

        <div class="maps-container">
            <div class="map-panel">
                <div class="map-header">
                    <h2>Without Spatial Index</h2>
                    <div class="timing">
                        <div class="timing-row">
                            <span class="label">DB time:</span>
                            <span id="db-time-no-index" class="time db-time">--</span>
                        </div>
                        <div class="timing-row timing-row-secondary">
                            <span class="label">Client time:</span>
                            <span id="time-no-index" class="time client-time">--</span>
                        </div>
                    </div>
                </div>
                <div id="map-no-index" class="map"></div>
                <div class="results">
                    <span>Polygons found: <span id="count-no-index">--</span></span>
                </div>
            </div>

            <div class="map-panel">
                <div class="map-header">
                    <h2>With Spatial Index</h2>
                    <div class="timing">
                        <div class="timing-row">
                            <span class="label">DB time:</span>
                            <span id="db-time-indexed" class="time db-time">--</span>
                        </div>
                        <div class="timing-row timing-row-secondary">
                            <span class="label">Client time:</span>
                            <span id="time-indexed" class="time client-time">--</span>
                        </div>
                    </div>
                </div>
                <div id="map-indexed" class="map"></div>
                <div class="results">
                    <span>Polygons found: <span id="count-indexed">--</span></span>
                </div>
            </div>
        </div>

        <div class="info-panel">
            <h3>How it works</h3>
            <p>
                Both maps query identical datasets stored in Supabase (PostgreSQL + PostGIS).
                The left table has no spatial index, while the right table uses a GiST index
                on the geometry column. Pan/zoom the maps and click "Run Spatial Query" to
                see the performance difference.
            </p>
        </div>
    </main>

    <footer>
        <p>Built with Leaflet, Supabase, and PostGIS</p>
    </footer>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Supabase JS -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <!-- App JS -->
    <script src="js/env.js"></script>
    <script src="js/config.js"></script>
    <script src="js/supabase-client.js"></script>
    <script src="js/map.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
